## 2-1. 네 개의 영역

DDD에서 일반적인 애플리케이션은 다음의 **네 가지 영역으로 구성**:

- **표현 (Presentation)**  
  사용자의 요청을 해석하여 **응용 서비스에 전달**하고, 결과를 **사용자가 이해할 수 있는 형식으로 응답**

- **응용 (Application)**  
  도메인 모델을 이용하여 **사용자에게 제공할 기능을 조합 및 실행**  
  → 실제 비즈니스 로직은 도메인에서 구현

- **도메인 (Domain)**  
  핵심 비즈니스 로직과 규칙을 **직접 구현하는 영역**

- **인프라스트럭처 (Infrastructure)**  
  데이터베이스, 메시지 큐, 외부 API 등 **외부 시스템과의 연동 처리 담당**

> 💡 응용 계층은 **도메인을 사용하는 조립자 역할**만 하며, 비즈니스 판단은 하지 않음.  
> 규칙은 항상 도메인에 위치해야 함.

---

## 2-2. 계층 구조 아키텍처

- 위의 네 영역은 보통 **계층 구조(Layered Architecture)** 로 구현됨:

  **표현 → 응용 → 도메인 → 인프라스트럭처**

- **구현의 편의성**을 위해 계층 구조를 **유연하게 적용**하는 경우도 있음.
  - 응용 → 인프라스트럭처
  - 도메인 → 인프라스트럭처

> 📌 예시:  
> 서비스에서 직접 리포지토리 구현체를 호출하거나, 도메인 객체가 외부 API 클라이언트를 직접 호출하는 경우

- 이렇게 되면, **도메인/응용 계층이 인프라에 의존하게 되어 테스트가 어려워지고**, 유연성이 떨어짐..

- 이러한 문제는 **DIP(의존성 역전 원칙)** 을 적용하여 **해결할 수 있음.**

---

## 2-3. DIP (Dependency Inversion Principle)

- **의존 역전 원칙**: 저수준 모듈이 고수준 모듈에 의존하도록 의존 방향을 변경하는 원칙
- 잘못 이해할 수 있는 부분:
  - 단순히 **인터페이스와 구현 클래스를 분리**하는 것이 전부가 아님
  - 도메인 영역(고수준)이 인프라스트럭처 인터페이스(저수준)에 의존하면 여전히 **고수준이 저수준에 의존하는 구조**임
- 해결 방향:
  - 인터페이스를 **도메인 영역(고수준)**에 두고, 구현체는 **인프라스트럭처 영역(저수준)**에 위치시키는 방식이 바람직함
- **주의**: DIP는 **무조건 적용할 필요는 없음**  
  - 적용했을 때 얻는 **이점과 복잡도 증가를 함께 고려**해야 함

---

## 2-4. 도메인 영역의 주요 구성요소

- 도메인 계층은 다음과 같은 주요 구성요소로 이루어짐:
  - **엔티티 (Entity)**
  - **밸류 (Value Object)**
  - **애그리거트 (Aggregate)**
  - **리포지터리 (Repository)**
  - **도메인 서비스 (Domain Service)**

### 2.4.1 엔티티와 밸류

- **도메인 모델의 엔티티**는 단순한 데이터 보관 객체가 아니라, **데이터 + 행위(기능)**을 함께 가짐
- **값 객체(Value Object)**는 불변성을 유지하는 것이 권장됨
  - 예: `equals()`, `hashCode()` 재정의
- DB 테이블의 엔티티와는 관점이 다름

### 2.4.2 애그리거트

- 관련 있는 객체들을 하나로 묶은 **군집(aggregate)**
- 하나의 **루트 엔티티**를 중심으로 내부 객체를 관리
- 외부에서는 루트 엔티티를 통해서만 접근 가능

### 2.4.3 리포지터리

- **애그리거트 단위로 도메인 객체의 저장/조회**를 담당
- 도메인 계층에서는 인터페이스로 정의하고, 구현은 인프라스트럭처에서 담당

---

## 2-5. 요청 처리 흐름

1. **표현 계층 (UI)**  
   - 사용자 요청을 받음  
   - 요청 데이터 유효성 검사 및 형변환  
   - 응용 서비스에 전달

2. **응용 계층 (Application Service)**  
   - 도메인 모델을 이용해 기능 구현  
   - 리포지터리 사용해 데이터 저장/조회  
   - 도메인 상태를 변경하므로 **트랜잭션 관리 필요**

3. **도메인 계층**  
   - 핵심 비즈니스 로직 처리

---

## 2-6. 인프라스트럭처 개요

- 인프라스트럭처는 표현, 응용, 도메인 계층을 **기술적으로 지원**
- 의존을 무조건 제거할 필요는 없음  
  - 예: `@Entity`, `@Table`, `@Transactional` 등은 편리한 구현을 위해 사용
- **DIP가 주는 장점만큼, 구현의 편의성도 중요**

---

## 2-7. 모듈 구성

- 도메인의 크기에 따라 **유연한 패키지 구성**을 하면 됨
- 한 패키지에 **너무 많은 클래스가 몰리면 코드 가독성 저하**
- 권장 기준: **패키지당 10~15개 타입 이하**
